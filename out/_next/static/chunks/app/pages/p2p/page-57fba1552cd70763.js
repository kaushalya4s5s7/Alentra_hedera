(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9056],{14038:(e,t,a)=>{"use strict";a.d(t,{E:()=>d});var s=a(11681),r=a(84356);let n=[{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"description",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint80",name:"_roundId",type:"uint80"}],name:"getRoundData",outputs:[{internalType:"uint80",name:"roundId",type:"uint80"},{internalType:"int256",name:"answer",type:"int256"},{internalType:"uint256",name:"startedAt",type:"uint256"},{internalType:"uint256",name:"updatedAt",type:"uint256"},{internalType:"uint80",name:"answeredInRound",type:"uint80"}],stateMutability:"view",type:"function"},{inputs:[],name:"latestRoundData",outputs:[{internalType:"uint80",name:"roundId",type:"uint80"},{internalType:"int256",name:"answer",type:"int256"},{internalType:"uint256",name:"startedAt",type:"uint256"},{internalType:"uint256",name:"updatedAt",type:"uint256"},{internalType:"uint80",name:"answeredInRound",type:"uint80"}],stateMutability:"view",type:"function"},{inputs:[],name:"version",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],l={ETH:"ethereum",BNB:"binancecoin",tBNB:"binancecoin",MATIC:"matic-network",AVAX:"avalanche-2",USDT:"tether",USDC:"usd-coin","USDC.e":"usd-coin","USDT.e":"tether",DAI:"dai","DAI.e":"dai",WETH:"weth",WBTC:"wrapped-bitcoin",EDU:"edu-coin",HBAR:"hedera",BTC:"bitcoin",ADA:"cardano",SOL:"solana",DOT:"polkadot",LINK:"chainlink",UNI:"uniswap",BUSD:"binance-usd",SHIB:"shiba-inu",DOGE:"dogecoin",LTC:"litecoin",ARB:"arbitrum",OP:"optimism"};async function i(e){try{let t=l[e];if(!t)return console.warn("No CoinGecko ID mapping found for ".concat(e)),null;let a=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=".concat(t,"&vs_currencies=usd&x_cg_demo_api_key=CG-srkX4U9kccQLkZaVDskW8tV6"),{method:"GET",headers:{Accept:"application/json"},cache:"no-store"});if(!a.ok)return console.warn("CoinGecko API response not OK: ".concat(a.status)),null;let s=await a.json();if(!s[t]||!s[t].usd)return console.warn("No price data found for ".concat(e," (").concat(t,")")),null;let r=1/s[t].usd;return console.log("CoinGecko rate for ".concat(e,": ").concat(r," (1 USD = ").concat(r," ").concat(e,")")),r}catch(t){return console.error("Error fetching price from CoinGecko for ".concat(e,":"),t),null}}async function d(e,t,a){try{if(t.includes("USD"))return 1;try{let l=(r.f6[a]||[]).find(e=>e.symbol===t),i=null==l?void 0:l.priceFeed;if(!l)throw Error("Token ".concat(t," not found on chain ").concat(a));if(!i)throw Error("No price feed found for ".concat(t," on chain ").concat(a));let d=new s.NZ(i,n,e),[o,c]=await Promise.all([d.latestRoundData(),d.decimals()]),m=Number(o.answer)/10**Number(c),u=1/m;if(Number.isFinite(u)&&u>0)return console.log("Using Chainlink price feed for ".concat(t,": ").concat(u)),u;throw Error("Invalid exchange rate from Chainlink: ".concat(u))}catch(e){console.warn("Chainlink error for ".concat(t,":"),e)}let l=await i(t);if(null!==l&&l>0)return l;return console.warn("Falling back to hardcoded rates for ".concat(t)),({ETH:.001,BNB:.001,tBNB:.001,MATIC:.001,AVAX:.001,EDU:.001,ZOLLPTT:1})[t]||.001}catch(e){if(console.error("Error in getExchangeRate:",e),t.includes("USD"))return 1;return({ETH:.001,BNB:.001,tBNB:.001,MATIC:.001,AVAX:.001,EDU:.001,ZOLLPTT:1})[t]||.001}}},21988:(e,t,a)=>{"use strict";a.d(t,{Fm:()=>r,V9:()=>n,Y6:()=>l});var s=a(22732);let r="0x0000000000000000000000000000000000000000",n=(0,s.x)({id:296,name:"Hedera Testnet",nativeCurrency:{decimals:18,name:"HBAR",symbol:"HBAR"},rpcUrls:{default:{http:["/api/hashioProxy"]}},blockExplorers:{default:{name:"HashScan",url:"https://hashscan.io/testnet"}}}),l=[n]},53999:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var s=a(52596),r=a(39688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},58694:(e,t,a)=>{Promise.resolve().then(a.bind(a,70645))},70645:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eT});var s=a(95155),r=a(12115),n=a(31530),l=a(62741),i=a(14913),d=a(2145),o=a(17990),c=a(77196),m=a(68183),u=a(84661),x=a(13244),y=a(35883),p=a(67622),b=a(14493);let g=JSON.parse('{"HV":[{"inputs":[],"name":"CannotReimburse","type":"error"},{"inputs":[],"name":"InvalidPayee","type":"error"},{"inputs":[],"name":"NotPayee","type":"error"},{"inputs":[],"name":"NotPayer","type":"error"},{"inputs":[],"name":"NothingToClaim","type":"error"},{"inputs":[],"name":"PaymentAlreadyExists","type":"error"},{"inputs":[],"name":"ReentrancyGuardReentrantCall","type":"error"},{"inputs":[],"name":"TransferFailed","type":"error"},{"inputs":[],"name":"ZeroAmount","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"by","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"tokenAddress","type":"address"}],"name":"PaymentClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"by","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"tokenAddress","type":"address"}],"name":"PaymentReimbursed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"tokenAddress","type":"address"}],"name":"PaymentSent","type":"event"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"claim","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"getPaymentDetails","outputs":[{"internalType":"address","name":"payer","type":"address"},{"internalType":"address","name":"payee","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"createdAt","type":"uint256"},{"internalType":"string","name":"status","type":"string"},{"internalType":"address","name":"tokenAddress","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"paymentExists","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"payments","outputs":[{"internalType":"address","name":"payer","type":"address"},{"internalType":"address","name":"payee","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"createdAt","type":"uint256"},{"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"internalType":"uint8","name":"status","type":"uint8"},{"internalType":"address","name":"tokenAddress","type":"address"},{"internalType":"bool","name":"exists","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"reimburse","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"internalType":"address","name":"payee","type":"address"},{"internalType":"address","name":"tokenAddress","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"sendERC20","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"},{"internalType":"address","name":"payee","type":"address"}],"name":"sendETH","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"statusAsString","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"statusIsClaimed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"statusIsReimbursed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"paymentId","type":"bytes32"}],"name":"statusIsSent","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"}]}');var h=a(21988);let f="0x0000000000000000000000000000000000000000";h.V9.id;let v={[h.V9.id]:"0xe7F03Fd0a14c38831dEcA1DE68D7C5D057083bE1"},j={[h.V9.id]:[{symbol:"HBAR",address:"0x0000000000000000000000000000000000000000",decimals:18,priceFeed:""},{symbol:"USDT",address:"0xYourTestnetUSDTAddress",decimals:6,priceFeed:""},{symbol:"USDC",address:"0xYourTestnetUSDCAddress",decimals:6,priceFeed:""},{symbol:"DAI",address:"0xYourTestnetDAIAddress",decimals:18,priceFeed:""},{symbol:"WETH",address:"0xYourTestnetWETHAddress",decimals:18,priceFeed:""}]},N=g.HV,k=(e,t)=>e.map(e=>{let a={eventName:t,paymentId:e.args.paymentId,amount:e.args.amount,tokenAddress:e.args.tokenAddress,blockHash:e.blockHash};return"PaymentSent"===t?(a.from=e.args.from,a.to=e.args.to):a.by=e.args.by,a});function w(e){let{address:t,chain:a}=(0,d.F)(),s=(0,o.e)(),{data:g}=(0,c.G)(),{writeContractAsync:h}=(0,m.x)(),[w,S]=(0,r.useState)("0"),[A,C]=(0,r.useState)([]),[T,D]=(0,r.useState)(!1),[E,F]=(0,r.useState)({type:"",message:""}),[P,I]=(0,r.useState)(void 0),R=(null==a?void 0:a.id)?v[a.id]:void 0,{isLoading:U,isSuccess:B}=(0,u.g)({hash:P}),{data:H}=(0,x.Q)({address:(null==e?void 0:e.address)!==f?null==e?void 0:e.address:void 0,abi:b.xw,functionName:"balanceOf",args:t?[t]:void 0,query:{enabled:!!t&&!!e&&e.address!==f}}),_=(0,r.useCallback)(async()=>{if(!t||!s)return BigInt(0);try{return await s.getBalance({address:t})}catch(e){return console.error("Error getting native balance:",e),BigInt(0)}},[t,s]);(0,r.useEffect)(()=>{(async()=>{if((null==e?void 0:e.address)===f){let t=await _();S((0,l.Js)(t,e.decimals||18))}})()},[e,_]),(0,r.useEffect)(()=>{e&&e.address!==f&&H&&S((0,l.Js)(H,e.decimals||18))},[H,e]);let L=(0,r.useCallback)(async()=>{if(t&&s&&e)try{let a;if(e.address===f)a=await s.getBalance({address:t});else{let r=e.address;a=await s.readContract({address:r,abi:b.xw,functionName:"balanceOf",args:[t]})}let r=e.decimals||18,n=(0,l.Js)(a,r);S(n)}catch(t){console.error("Error fetching token balance:",t),n.oR.error("Failed to fetch your ".concat(e.symbol||"token"," balance"))}},[t,s,e]),M=(0,r.useCallback)(async()=>{if(t&&s&&R)try{D(!0);let e=await s.getBlockNumber(),r=BigInt(Math.max(0,Number(e)-5760)),n=(0,y.b)(t),[i,d,o,c]=await Promise.all([s.getContractEvents({address:R,abi:N,eventName:"PaymentSent",fromBlock:r,args:{from:n}}),s.getContractEvents({address:R,abi:N,eventName:"PaymentSent",fromBlock:r,args:{to:n}}),s.getContractEvents({address:R,abi:N,eventName:"PaymentClaimed",fromBlock:r}),s.getContractEvents({address:R,abi:N,eventName:"PaymentReimbursed",fromBlock:r})]),m=k(i,"PaymentSent"),u=k(d,"PaymentSent"),x=k(o,"PaymentClaimed"),p=k(c,"PaymentReimbursed"),g=new Map;for(let e of x){let t=await s.getBlock({blockHash:e.blockHash});g.set(e.paymentId,{status:"CLAIMED",timestamp:new Date(1e3*Number(t.timestamp)).toLocaleString(),by:e.by})}for(let e of p){let t=await s.getBlock({blockHash:e.blockHash});g.set(e.paymentId,{status:"REIMBURSED",timestamp:new Date(1e3*Number(t.timestamp)).toLocaleString(),by:e.by})}let h=await Promise.all([...m,...u].map(async e=>{let t,{paymentId:r,from:n,to:i,amount:d,tokenAddress:o}=e,c=await s.getBlock({blockHash:e.blockHash}),m=g.get(r)||{status:"SENT",timestamp:new Date(1e3*Number(c.timestamp)).toLocaleString()};if(o===f){var u;let e=(null==a?void 0:a.id)?j[a.id]:void 0,s=null==e?void 0:e.find(e=>e.address===f);t={symbol:(null==s?void 0:s.symbol)||(null==a||null==(u=a.nativeCurrency)?void 0:u.symbol)||"ETH",decimals:(null==s?void 0:s.decimals)||18}}else{let e=(null==a?void 0:a.id)?j[a.id]:void 0,r=null==e?void 0:e.find(e=>e.address.toLowerCase()===o.toLowerCase());if(r)t={symbol:r.symbol,decimals:r.decimals};else try{let e=await s.readContract({address:o,abi:b.xw,functionName:"symbol"}),a=await s.readContract({address:o,abi:b.xw,functionName:"decimals"});t={symbol:e,decimals:Number(a)}}catch(e){console.warn("Could not get info for token at ".concat(o)),t={symbol:"UNKNOWN",decimals:18}}}let x=(0,l.Js)(d,t.decimals);return{parsedJson:{payment_id:r,payment_object_id:r,from:n,to:i,amount:x,tokenAddress:o,tokenSymbol:t.symbol,created_at:Number(c.timestamp),statusInfo:m}}}));C(h)}catch(e){console.error("Error fetching payments:",e),n.oR.error("Failed to fetch payment history")}finally{D(!1)}},[t,s,R,a]);(0,r.useEffect)(()=>{t&&s&&(L(),M())},[t,s,e,a,L,M]);let{data:z,refetch:W}=(0,x.Q)({address:(null==e?void 0:e.address)!==f?null==e?void 0:e.address:void 0,abi:b.xw,functionName:"allowance",args:t&&R?[t,R]:void 0,query:{enabled:!!t&&!!R&&!!e&&e.address!==f}}),V=e=>(0,i.S)((0,p.i3)(e)),J=async()=>{if(!s)return!1;try{return await s.getBlockNumber(),!0}catch(e){return console.error("Network health check failed:",e),!1}},G=async()=>{if(s)try{var e,t;if(null==(t=s.chain)||null==(e=t.fees)||!e.baseFeeMultiplier)return{gasPrice:await s.getGasPrice()*BigInt(2)};{let e=await s.estimateFeesPerGas();return{maxFeePerGas:e.maxFeePerGas?e.maxFeePerGas*BigInt(2):void 0,maxPriorityFeePerGas:e.maxPriorityFeePerGas?e.maxPriorityFeePerGas*BigInt(2):void 0}}}catch(e){console.error("Error estimating gas:",e);return}},O=async(s,r,i)=>{if(D(!0),F({type:"",message:""}),!t||!g){F({type:"error",message:"Wallet not connected"}),D(!1);return}if(!s||!r||!i){F({type:"error",message:"Please fill all required fields"}),D(!1);return}let d=parseFloat(i);if(isNaN(d)||d<=0){F({type:"error",message:"Please enter a valid amount greater than zero"}),D(!1);return}if(!R){F({type:"error",message:"Contract not deployed on this network"}),D(!1);return}if(!await J()){F({type:"error",message:"Network connection issues detected. Please try again later."}),D(!1);return}try{var o,c,m;let t="".concat(s,"-").concat(Date.now(),"-").concat(Math.floor(1e7*Math.random()),"-").concat(crypto.randomUUID().slice(0,8)),n=V(t);console.log("Payment ID:",t),console.log("Bytes Payment ID:",n),console.log("Payee Address:",r);let d=e.decimals||18,u=BigInt((0,l.XS)(i,d).toString());console.log("Amount in Wei:",u.toString());let x=e.address===f||"0x0000000000000000000000000000000000001010"===e.address||(null==(o=e.symbol)?void 0:o.toUpperCase())===(null==a||null==(m=a.nativeCurrency)||null==(c=m.symbol)?void 0:c.toUpperCase());if(console.log("Is Native Token:",x),console.log("Selected Token:",e),console.log("Contract Address:",R),x){F({type:"info",message:"Preparing transaction, please confirm in your wallet..."});try{let e=BigInt(3e6);console.log("Using hardcoded gas limit: ".concat(e));let t=await G();console.log("Sending transaction with params:",{address:R,functionName:"sendETH",args:[n,r],value:u,gas:e,...t});let a=await h({address:R,abi:N,functionName:"sendETH",args:[n,r],value:u,gas:e,...t});I(a),F({type:"info",message:"Transaction sent. Waiting for confirmation..."})}catch(e){throw console.error("Inner transaction error:",e),e.shortMessage&&console.error("Error short message:",e.shortMessage),e.cause&&console.error("Error cause:",e.cause),e}}}catch(a){console.error("Transaction failed:",a);let e=a.message||"Unknown error",t=e.match(/reverted with reason string '([^']+)'/);t&&t[1]&&(e=t[1]),F({type:"error",message:"Error: ".concat(e)}),n.oR.error("Transaction failed: ".concat(e)),D(!1)}};(0,r.useEffect)(()=>{B&&P&&(F({type:"success",message:"Transaction successful! Hash: ".concat(P)}),n.oR.success("Transaction completed successfully!"),M(),L(),D(!1),setTimeout(()=>{I(void 0)},5e3))},[B,P,M,L]);let Y=async(e,a)=>{var s,r;if(!e)return void F({type:"error",message:"Please enter a payment ID"});if(!t||!g)return void F({type:"error",message:"Wallet not connected"});let l=A.find(t=>t.parsedJson.payment_id===e||t.parsedJson.payment_object_id===e);if(l&&(null==(s=l.parsedJson.statusInfo)?void 0:s.status)!=="SENT"){F({type:"error",message:"This payment cannot be ".concat(a,"ed because it has status: ").concat(null==(r=l.parsedJson.statusInfo)?void 0:r.status)}),n.oR.error("Payment is not in a ".concat(a,"able state"));return}D(!0),F({type:"info",message:"Preparing transaction..."});try{if(!R)throw Error("Contract address not available");let t=e.startsWith("0x")&&66===e.length?e:V(e);F({type:"info",message:"Initiating ".concat(a,". Please confirm in your wallet...")});let s=BigInt(3e6);console.log("Using hardcoded gas limit for ".concat(a,": ").concat(s));let r=await G(),n=await h({address:R,abi:N,functionName:a,args:[t],gas:s,...r});I(n),F({type:"info",message:"Transaction sent. Waiting for confirmation..."})}catch(e){console.error("".concat(a," transaction failed:"),e),F({type:"error",message:"Error: ".concat(e.message||"Transaction failed")}),n.oR.error("Transaction failed: ".concat(e.message)),D(!1)}};return{currentAccount:t,coinObjects:[{balance:w}],payments:A,isLoading:T||U,resultMessage:E,setResultMessage:F,sendPayment:O,executePaymentAction:Y,fetchPayments:M,fetchUserCoins:L}}var S=a(18224),A=a(47924),C=a(55868),T=a(25305),D=a(81284),E=a(40646),F=a(54861),P=a(1243),I=a(54416);function R(e){let{message:t,onDismiss:a}=e,[n,l]=(0,r.useState)(!1),[i,d]=(0,r.useState)("");if((0,r.useEffect)(()=>{t.message&&t.message!==i&&(l(!0),d(""))},[t,i]),!t.message||!n)return null;let o={container:"border-gray-200 bg-gray-50 text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200",icon:"text-gray-500 dark:text-gray-400"},c=D.A;switch(t.type){case"success":o.container="border-green-200 bg-green-50 text-green-800 dark:border-green-800/30 dark:bg-green-900/20 dark:text-green-400",o.icon="text-green-500 dark:text-green-400",c=E.A;break;case"error":o.container="border-red-200 bg-red-50 text-red-800 dark:border-red-800/30 dark:bg-red-900/20 dark:text-red-400",o.icon="text-red-500 dark:text-red-400",c=F.A;break;case"info":o.container="border-blue-200 bg-blue-50 text-blue-800 dark:border-blue-800/30 dark:bg-blue-900/20 dark:text-blue-400",o.icon="text-blue-500 dark:text-blue-400",c=D.A;break;case"warning":o.container="border-yellow-200 bg-yellow-50 text-yellow-800 dark:border-yellow-800/30 dark:bg-yellow-900/20 dark:text-yellow-400",o.icon="text-yellow-500 dark:text-yellow-400",c=P.A}return(0,s.jsxs)("div",{className:"\n                flex items-start justify-between px-4 py-3 mb-4 rounded-lg border \n                shadow-sm transition-all duration-300 ease-in-out\n                ".concat(o.container," \n                ").concat(n?"opacity-100 transform translate-y-0":"opacity-0 transform -translate-y-2","\n            "),role:"alert",children:[(0,s.jsxs)("div",{className:"flex items-start flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mr-3 ".concat(o.icon),children:(0,s.jsx)(c,{size:18})}),(0,s.jsx)("div",{className:"flex-1 text-sm font-medium break-words overflow-auto max-h-24",children:t.message})]}),a&&(0,s.jsx)("button",{onClick:()=>{l(!1),d(t.message),a&&a()},className:"ml-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 flex-shrink-0",children:(0,s.jsx)(I.A,{size:16})})]})}var U=a(14038),B=a(28707);function H(e){let{selectedToken:t,isLoading:a,resultMessage:n,onSendPayment:l,onDismissResult:i}=e,[c,m]=(0,r.useState)(""),[u,x]=(0,r.useState)(""),[y,p]=(0,r.useState)(0),[b,g]=(0,r.useState)(!1),[h,f]=(0,r.useState)(""),[v,j]=(0,r.useState)(""),[N,k]=(0,r.useState)(""),[w,D]=(0,r.useState)(!1),{address:E}=(0,d.F)(),F=(0,S.i)(),P=(0,o.e)(),[I,H]=(0,r.useState)([]),[_,L]=(0,r.useState)(!1),[M,z]=(0,r.useState)(""),[W,V]=(0,r.useState)(!1);(0,r.useEffect)(()=>{j("payment-".concat(Date.now(),"-").concat(Math.floor(1e6*Math.random())))},[]),(0,r.useEffect)(()=>{E&&J()},[E]),(0,r.useEffect)(()=>{D(a)},[a]),(0,r.useEffect)(()=>{(async()=>{if(t&&F)try{let e;g(!0),e=P&&"transport"in P&&"url"in P.transport?new B.FR(P.transport.url):new B.FR;let a=await (0,U.E)(e,t.symbol,F);p(a)}catch(e){console.error("Failed to fetch ".concat(null==t?void 0:t.symbol," exchange rate:"),e),k("Could not fetch current ".concat(null==t?void 0:t.symbol," price. Using fallback rate.")),(null==t?void 0:t.symbol.includes("USD"))?p(1):p(.001)}finally{g(!1)}})()},[t,F,P]),(0,r.useEffect)(()=>{(async()=>{if(!u||!t||isNaN(parseFloat(u))||0>=parseFloat(u))return m("");g(!0);try{let e=y>0?y:t.symbol.includes("USD")?1:.001,a=parseFloat(u);m((a*e).toFixed(6))}catch(e){console.error("Error converting USD to ".concat(t.symbol,":"),e),k("Could not convert USD to ".concat(t.symbol,". Please try again."))}finally{g(!1)}})()},[u,y,t]);let J=async()=>{try{let e=await (0,T.QC)();H(e.data)}catch(e){console.error("Failed to load address book:",e)}},G=async e=>{if(z(e),e.length>0){V(!0);try{let t=await (0,T.vC)(e);H(t.data)}catch(e){console.error("Address search failed:",e)}finally{V(!1)}}else J()},O=e=>{f(e.walletAddress),L(!1)},Y=async()=>{if(!h||!c)return void k("Please provide both recipient and amount");if(!h.startsWith("0x")||42!==h.length)try{let e=await (0,T.S1)(h);if(!e.startsWith("0x")||42!==e.length)return void k("Invalid Ethereum address format");f(e)}catch(e){k("Could not resolve nickname: ".concat(h));return}k(""),D(!0);try{l(v,h,c)}catch(e){k("Payment failed: "+(e instanceof Error?e.message:String(e))),D(!1)}},q=a||w;return(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsxs)("div",{className:"max-w-4xl w-full space-y-6 backdrop-blur-sm p-8 rounded-lg",children:[(0,s.jsx)(R,{message:N?{type:"error",message:N}:n||{type:"",message:""},onDismiss:()=>{k(""),i&&i()}}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recipient Address or Username"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:h,onChange:e=>{let t=e.target.value;f(t),t.length>2?(L(!0),G(t)):0===t.length&&L(!1)},onKeyPress:e=>{"Enter"===e.key&&(L(!0),G(h))},className:"w-full p-2 pr-10 bg-transparent border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none text-gray-900 dark:text-white",placeholder:"0x... or username",disabled:q}),(0,s.jsx)("button",{type:"button",onClick:()=>{L(!_),_||J()},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",disabled:q,children:(0,s.jsx)(A.A,{size:18})}),_&&(0,s.jsx)("div",{className:"absolute z-10 w-full mt-1 backdrop-blur-md bg-white/70 dark:bg-gray-800/70 rounded-md shadow-lg",children:(0,s.jsx)("div",{className:"max-h-48 overflow-y-auto",children:W?(0,s.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:"Searching..."}):I.length>0?I.map(e=>(0,s.jsxs)("div",{className:"p-3 hover:bg-gray-100/80 dark:hover:bg-gray-700/80 cursor-pointer border-b border-gray-200/50 dark:border-gray-700/50",onClick:()=>O(e),children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.nickname}),(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.walletAddress})]},e._id)):(0,s.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:M?"No contacts found":"Your address book is empty"})})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Amount (USD)"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-2",children:(0,s.jsx)(C.A,{size:16,className:"text-gray-500 dark:text-gray-400"})}),(0,s.jsx)("input",{type:"text",value:u,onChange:e=>{let t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&x(t)},className:"w-full p-2 pl-8 bg-transparent border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none text-gray-900 dark:text-white",placeholder:"0.00",disabled:q})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Equivalent in ",(null==t?void 0:t.symbol)||"Token"]}),(0,s.jsx)("div",{className:"relative",children:b?(0,s.jsx)("div",{className:"w-full p-2 bg-transparent border-b border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",children:"Converting..."}):(0,s.jsx)("div",{className:"w-full p-2 bg-transparent border-b border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",children:c?"".concat(c," ").concat((null==t?void 0:t.symbol)||"Token"):"0.00 ".concat((null==t?void 0:t.symbol)||"Token")})}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Exchange Rate: 1 USD ≈ ",y>0?y.toFixed(6):"..."," ",(null==t?void 0:t.symbol)||"Token"]})]})]}),(0,s.jsx)("button",{type:"button",onClick:Y,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 hover:from-blue-700 hover:to-blue-800 text-white py-3 rounded-md font-medium shadow-md transition-all duration-300 disabled:opacity-70 disabled:cursor-not-allowed",disabled:q||b||!c||!h,children:q&&w?(0,s.jsxs)("span",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending Payment..."]}):b?"Preparing...":"Send ".concat(c?c+" "+((null==t?void 0:t.symbol)||"Token"):"Payment")})]})})}function _(){return(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Important:"})," Only payments with 'Sent' status can be claimed or reimbursed."]}),(0,s.jsxs)("ul",{className:"list-disc pl-5 text-sm",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-medium text-blue-600",children:"Sent"})," - Payment is waiting to be claimed by recipient or reimbursed by sender"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-medium text-green-600",children:"Claimed"})," - Payment has already been claimed by the recipient"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-medium text-yellow-600",children:"Reimbursed"})," - Payment has been returned to the sender"]})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs",children:[(0,s.jsx)("span",{className:"font-medium",children:"Note:"})," If a payment has already been claimed, it cannot be reimbursed. If it has been reimbursed, it cannot be claimed."]})]})}function L(e){let{onClick:t,isDisabled:a,actionType:r,buttonType:n,isLoading:l,title:i,label:d,activeColor:o}=e,c={"dark:bg-green-500 bg-green-300":{base:"bg-green-300 dark:bg-green-500",hover:"hover:bg-green-400 dark:hover:bg-green-600",active:"active:bg-green-500 dark:active:bg-green-700",shadow:"shadow-green-200/50 dark:shadow-green-900/20"},"dark:bg-yellow-500 bg-yellow-300":{base:"bg-yellow-300 dark:bg-yellow-500",hover:"hover:bg-yellow-400 dark:hover:bg-yellow-600",active:"active:bg-yellow-500 dark:active:bg-yellow-700",shadow:"shadow-yellow-200/50 dark:shadow-yellow-900/20"}}[o]||{base:"bg-gray-300 dark:bg-gray-600",hover:"hover:bg-gray-400 dark:hover:bg-gray-700",active:"active:bg-gray-500 dark:active:bg-gray-800",shadow:"shadow-gray-200/50 dark:shadow-gray-900/20"};return(0,s.jsxs)("button",{onClick:t,disabled:a,className:"\n                flex-1 relative py-3 px-6 rounded-lg font-medium text-sm\n                transition-all duration-200 ease-in-out\n                transform hover:scale-[1.02] active:scale-[0.98]\n                focus:outline-none focus:ring-2 focus:ring-opacity-50\n                \n                ".concat(r===n?"\n                    ".concat(c.base,"\n                    shadow-lg ").concat(c.shadow,"\n                    ").concat(c.hover,"\n                    ").concat(c.active,"\n                    focus:ring-opacity-50 focus:ring-green-400 dark:focus:ring-green-700\n                "):"\n                    bg-gray-200 dark:bg-gray-700\n                    hover:bg-gray-300 dark:hover:bg-gray-600\n                    shadow-md shadow-gray-200/30 dark:shadow-gray-900/10\n                    active:bg-gray-400 dark:active:bg-gray-800\n                    focus:ring-gray-400 dark:focus:ring-gray-500\n                ","\n                \n                disabled:opacity-60 disabled:cursor-not-allowed\n                disabled:shadow-none disabled:transform-none\n                disabled:bg-gray-200 dark:disabled:bg-gray-800\n                disabled:hover:scale-100\n                \n                text-gray-800 dark:text-white\n            "),title:i,children:[l?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("span",{children:"Processing..."})]}):(0,s.jsx)("span",{children:d}),!a&&(0,s.jsx)("span",{className:"absolute inset-0 rounded-lg opacity-20 bg-gradient-to-t from-black/5 to-white/20 pointer-events-none"})]})}function M(e){var t,a,n,l;let{isLoading:i,payments:o,onExecutePaymentAction:c,preselectedPaymentId:m="",preselectedAction:u,onClearAction:x}=e,{address:y}=(0,d.F)(),[p,b]=(0,r.useState)(m),[g,h]=(0,r.useState)(u),[f,v]=(0,r.useState)({type:"",message:""});(0,r.useEffect)(()=>{b(m),h(u)},[m,u]);let j=e=>{c(p,e),h(e)},N=o.find(e=>e.parsedJson.payment_object_id===p);return(0,s.jsxs)("div",{children:[(0,s.jsx)(R,{message:f,onDismiss:()=>{v({type:"",message:""})}}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-gray-900 dark:text-white",children:"Payment ID"}),(0,s.jsx)("input",{type:"text",value:p,onChange:e=>{b(e.target.value),h(null),e.target.value!==m&&x()},placeholder:"0x...",className:"bg-transparent w-full p-2 border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none text-gray-900 dark:text-white"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the payment ID you want to claim or reimburse"})]}),p&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-gray-800/30 rounded-md",children:[(0,s.jsx)("h4",{className:"font-medium text-sm mb-2 text-gray-900 dark:text-white",children:"Payment Status Check"}),(0,s.jsx)(_,{}),N&&(0,s.jsxs)("div",{className:"mt-3 p-2 bg-white dark:bg-gray-800/50 border-b border-gray-300 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white",children:[(0,s.jsx)("strong",{children:"Payment ID:"})," ",N.parsedJson.payment_id]}),(0,s.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white",children:[(0,s.jsx)("strong",{children:"Amount:"})," ",N.parsedJson.amount," ",N.parsedJson.tokenSymbol]})]})]}),(0,s.jsx)("div",{className:"flex flex-row items-center justify-center",children:(0,s.jsxs)("div",{className:"w-auto space-x-3",children:[(0,s.jsx)(L,{onClick:()=>j("claim"),isDisabled:i||"reimburse"===g||!N||(null==(t=N.parsedJson.statusInfo)?void 0:t.status)!=="SENT"||(null==(a=N.parsedJson.from)?void 0:a.toLowerCase())===(null==y?void 0:y.toLowerCase()),actionType:g,buttonType:"claim",isLoading:i,title:"Claim this payment to your wallet",label:"Claim Payment",activeColor:"dark:bg-green-500 bg-green-300"}),(0,s.jsx)(L,{onClick:()=>j("reimburse"),isDisabled:i||"claim"===g||!N||(null==(n=N.parsedJson.statusInfo)?void 0:n.status)!=="SENT"||(null==(l=N.parsedJson.from)?void 0:l.toLowerCase())!==(null==y?void 0:y.toLowerCase()),actionType:g,buttonType:"reimburse",isLoading:i,title:"Return this payment to your wallet",label:"Reimburse Payment",activeColor:"dark:bg-yellow-500 bg-yellow-300"})]})})]})}function z(e){let{status:t}=e,a="bg-blue-100 text-blue-800",r="Pending";return"CLAIMED"===t?(a="bg-green-100 text-green-800",r="Claimed"):"REIMBURSED"===t&&(a="bg-yellow-100 text-yellow-800",r="Reimbursed"),(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(a),children:r})}function W(e){var t,a,r,n,l,i;let{payment:d,currentUserAddress:o,selectedToken:c,onActionSelected:m}=e,u=d.parsedJson,x=(null==(t=u.from)?void 0:t.toLowerCase())===(null==o?void 0:o.toLowerCase()),y=(null==(a=u.to)?void 0:a.toLowerCase())===(null==o?void 0:o.toLowerCase()),p=(null==(r=u.statusInfo)?void 0:r.status)||"SENT",b=y&&"SENT"===p,g=x&&"SENT"===p,h="string"==typeof u.payment_id?u.payment_id:String(u.payment_id);return(0,s.jsxs)("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900/10",children:[(0,s.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:h}),(0,s.jsx)("td",{className:"px-4 py-2 text-sm",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(x?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"),children:x?"Sent":"Received"})}),(0,s.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:x?"To: ".concat(null==(n=u.to)?void 0:n.substring(0,8),"..."):"From: ".concat(null==(l=u.from)?void 0:l.substring(0,8),"...")}),(0,s.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:[u.amount," ",u.tokenSymbol||(null==c?void 0:c.symbol)||"ETH"]}),(0,s.jsxs)("td",{className:"px-4 py-2 text-sm",children:[(0,s.jsx)(z,{status:p}),(null==(i=u.statusInfo)?void 0:i.timestamp)&&(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:u.statusInfo.timestamp})]}),(0,s.jsxs)("td",{className:"px-4 py-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex space-x-2",children:[b&&(0,s.jsx)("button",{onClick:()=>m(u.payment_object_id,"claim"),className:"px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600",title:"Claim this payment to your wallet",children:"Claim"}),g&&(0,s.jsx)("button",{onClick:()=>m(u.payment_object_id,"reimburse"),className:"px-3 py-1 bg-yellow-500 text-white text-xs rounded hover:bg-yellow-600",title:"Return this payment to your wallet",children:"Reimburse"}),!b&&!g&&(0,s.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"CLAIMED"===p?"Payment claimed":"Payment reimbursed"})]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["ID: ",u.payment_object_id.substring(0,8),"..."]})]})]})}let V=e=>{let{payments:t,selectedToken:a,onActionSelected:r}=e,{address:n}=(0,d.F)();return n?(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium mb-3 text-gray-900 dark:text-white",children:"Payment History"}),0===t.length?(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No payments found."}):(0,s.jsx)("div",{className:"overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Payment ID"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Direction"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Address"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Amount"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:t.map((e,t)=>(0,s.jsx)(W,{payment:e,currentUserAddress:n,selectedToken:a,onActionSelected:r},t))})]})})]}):(0,s.jsx)("div",{className:"text-gray-900 dark:text-white",children:"Please connect your wallet to view payment history."})};var J=a(49103),G=a(75525),O=a(28883),Y=a(13717),q=a(62525);function Q(e){let{initialData:t=null,onSubmit:a,onCancel:n,validateAddress:l}=e,[i,d]=(0,r.useState)(""),[o,c]=(0,r.useState)(""),[m,u]=(0,r.useState)(""),[x,y]=(0,r.useState)({});(0,r.useEffect)(()=>{t&&(d(t.nickname),c(t.walletAddress),u(t.email||""))},[t]);let p=()=>{let e={};return i.trim()||(e.nickname="Nickname is required"),o.trim()||(e.walletAddress="Wallet address is required"),m&&!m.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)&&(e.email="Please enter a valid email address"),o&&!l(o)&&(e.walletAddress="Invalid wallet address format"),y(e),0===Object.keys(e).length};return(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),p()&&(a({nickname:i,walletAddress:o,email:m}),t||(d(""),c(""),u("")))},className:"border-b border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-transparent backdrop-blur-md",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"nickname",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nickname"}),(0,s.jsx)("input",{id:"nickname",type:"text",value:i,onChange:e=>d(e.target.value),className:"w-full p-2 bg-transparent border-b focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white ".concat(x.nickname?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter a nickname"}),x.nickname&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.nickname})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"walletAddress",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"EVM Wallet Address"}),(0,s.jsx)("input",{id:"walletAddress",type:"text",value:o,onChange:e=>c(e.target.value),className:"w-full p-2 bg-transparent border-b focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white ".concat(x.walletAddress?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"0x..."}),x.walletAddress&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.walletAddress})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Address"}),(0,s.jsx)("input",{id:"email",type:"email",value:m,onChange:e=>u(e.target.value),className:"w-full p-2 bg-transparent border-b focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white ".concat(x.email?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"example@domain.com"}),x.email&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.email})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 border-b border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100/20 dark:hover:bg-gray-700/20",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 hover:from-blue-700 hover:to-blue-800 text-white rounded-md shadow-sm",children:t?"Update":"Save"})]})]})}var Z=a(81757);function K(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),[i,o]=(0,r.useState)(""),[c,m]=(0,r.useState)(!1),[u,x]=(0,r.useState)(null),{address:y,isConnected:p}=(0,d.F)();(0,r.useEffect)(()=>{y&&p&&b()},[y,p]);let b=async()=>{l(!0);try{let e=await (0,T.QC)();t(e.data)}catch(e){console.error("Failed to fetch addresses:",e),n.oR.error("Failed to load address book")}finally{l(!1)}},g=e=>(0,Z.P)(e),h=async e=>{let a=e.target.value;if(o(a),a.length>0){l(!0);try{let e=await (0,T.vC)(a);t(e.data)}catch(e){console.error("Search failed:",e),n.oR.error("Search failed. Please try again.")}finally{l(!1)}}else b()},f=async e=>{try{let t=e.walletAddress.toLowerCase().startsWith("0x")?e.walletAddress:"0x".concat(e.walletAddress);await (0,T.E1)(e.nickname,t,e.email),m(!1),n.oR.success("Contact added successfully"),b()}catch(e){var t,a;console.error("Failed to add address:",e),n.oR.error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Failed to add contact")}},v=async e=>{try{if(!u)return;let t=e.walletAddress.toLowerCase().startsWith("0x")?e.walletAddress:"0x".concat(e.walletAddress),a={...t!==u.walletAddress?{walletAddress:t}:{},...e.nickname!==u.nickname?{newNickname:e.nickname}:{},...e.email!==u.email?{email:e.email}:{}};await (0,T.yU)(u.nickname,a),x(null),n.oR.success("Contact updated successfully"),b()}catch(e){var t,a;console.error("Failed to update address:",e),n.oR.error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Failed to update contact")}},[j,N]=(0,r.useState)(!1),[k,w]=(0,r.useState)(""),S=e=>{w(e),N(!0)},C=async()=>{try{await (0,T.ab)(k),n.oR.success("Contact deleted successfully"),b()}catch(e){console.error("Failed to delete address:",e),n.oR.error("Failed to delete contact")}finally{N(!1)}},D=e=>e?e.length<10?e:"".concat(e.substring(0,6),"...").concat(e.substring(e.length-4)):"";return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Address Book"}),(0,s.jsxs)("button",{onClick:()=>m(!c),className:"flex items-center gap-1 bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white px-3 py-2 rounded-md",children:[(0,s.jsx)(J.A,{size:16}),(0,s.jsx)("span",{children:"Add Contact"})]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(A.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",size:18}),(0,s.jsx)("input",{type:"text",placeholder:"Search contacts...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-transparent text-gray-900 dark:text-white",value:i,onChange:h})]}),c&&(0,s.jsx)(Q,{onSubmit:f,onCancel:()=>m(!1),validateAddress:g}),u&&(0,s.jsx)(Q,{initialData:u,onSubmit:v,onCancel:()=>x(null),validateAddress:g}),(0,s.jsx)("div",{className:"mt-4",children:a?(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):e.length>0?(0,s.jsx)("div",{className:"grid gap-2",children:e.map(e=>(0,s.jsxs)("div",{className:"flex justify-between items-center p-3 border border-gray-200 dark:border-gray-700 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white",children:e.nickname}),e.isVerifiedUser&&(0,s.jsx)(G.A,{size:16,className:"ml-2 text-green-500"})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[D(e.walletAddress),(0,s.jsx)("button",{className:"ml-2 text-blue-500 hover:text-blue-600 text-xs",onClick:()=>{navigator.clipboard.writeText(e.walletAddress),n.oR.success("Address copied to clipboard")},children:"Copy"})]}),e.email&&(0,s.jsxs)("div",{className:"flex items-center mt-1 text-xs text-gray-500 dark:text-gray-400",children:[(0,s.jsx)(O.A,{size:12,className:"mr-1"}),(0,s.jsx)("span",{children:e.email})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>x(e),className:"p-1 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400",children:(0,s.jsx)(Y.A,{size:18})}),(0,s.jsx)("button",{onClick:()=>S(e.nickname),className:"p-1 text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400",children:(0,s.jsx)(q.A,{size:18})})]})]},e._id))}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:i?"No contacts found":"Your address book is empty"})}),j&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Confirm Deletion"}),(0,s.jsxs)("p",{className:"mb-6",children:["Are you sure you want to delete ",k,"?"]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:()=>N(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),(0,s.jsx)("button",{onClick:C,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})]})]})})]})}let X=e=>{let{selectedToken:t}=e,[a,n]=(0,r.useState)("send"),[l,i]=(0,r.useState)(""),[d,o]=(0,r.useState)(null),{payments:c,isLoading:m,resultMessage:u,setResultMessage:x,sendPayment:y,executePaymentAction:p}=w(t),b=()=>{i(""),o(null)};return(0,s.jsxs)("div",{className:"mt-8 min-w-[70vw] bg-transparent rounded-xl overflow-hidden",children:[(0,s.jsx)("div",{className:"flex border-b border-gray-200 dark:border-gray-800 mb-4",children:[{id:"send",label:"Send Payment"},{id:"claim",label:"Claim/Reimburse"},{id:"history",label:"Payment History"},{id:"addressBook",label:"Address Book"}].map(e=>(0,s.jsx)("button",{onClick:()=>{n(e.id),b()},className:"px-4 py-3 text-sm font-medium ".concat(a===e.id?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"),children:e.label},e.id))}),(0,s.jsxs)("div",{className:"p-4",children:["send"===a&&(0,s.jsx)(H,{selectedToken:t,isLoading:m,resultMessage:u,onSendPayment:y,onDismissResult:()=>{x({type:"",message:""})}}),"claim"===a&&(0,s.jsx)(M,{isLoading:m,payments:c,onExecutePaymentAction:p,preselectedPaymentId:l,preselectedAction:d,onClearAction:b}),"history"===a&&(0,s.jsx)(V,{payments:c,selectedToken:t,onActionSelected:(e,t)=>{i(e),o(t),n("claim")}}),"addressBook"===a&&(0,s.jsx)(K,{})]})]})};var $=a(97822),ee=a(74228);let et=async(e,t,a)=>(await ee.A.post("/split-bill",{invoiceId:e,initiatorWalletAddress:t,participants:a})).data,ea=async()=>(await ee.A.get("/split-bill/initiated")).data,es=async()=>(await ee.A.get("/split-bill/participating")).data,er=async(e,t,a)=>(await ee.A.patch("/split-bill/".concat(e,"/participant/").concat(t),{transactionHash:a})).data;var en=a(14186),el=a(17580);let ei=e=>{let{selectedToken:t,refreshTrigger:a=0}=e,[l,i]=(0,r.useState)([]),[c,m]=(0,r.useState)([]),[u,x]=(0,r.useState)("initiated"),[y,p]=(0,r.useState)(!0),[b,g]=(0,r.useState)(null),[h,f]=(0,r.useState)(null),[v,j]=(0,r.useState)(!1),[N,k]=(0,r.useState)(0),{address:S}=(0,d.F)(),{user:A}=(0,$.A)(),T=(0,o.e)(),{sendPayment:D,isLoading:F,resultMessage:P,setResultMessage:H}=w(t);(0,r.useEffect)(()=>{(async()=>{if(A){p(!0);try{let e=await ea();i(e.data);let t=await es();m(t.data)}catch(e){console.error("Failed to fetch split bills:",e),n.oR.error("Failed to load your split bills")}finally{p(!1)}}})()},[a,A]),(0,r.useEffect)(()=>{(async()=>{if(t&&T)try{var e;let a,s=(null==(e=T.chain)?void 0:e.id)||1;a="transport"in T&&"url"in T.transport?new B.FR(T.transport.url):new B.FR;let r=await (0,U.E)(a,t.symbol,s);k(r),console.log("Exchange rate loaded: 1 USD = ".concat(r," ").concat(t.symbol))}catch(e){console.error("Failed to fetch ".concat(t.symbol," exchange rate:"),e),t.symbol.includes("USD")?k(1):k(.001)}})()},[t,T]);let _=e=>S&&(null==A?void 0:A.email)?e.participants.find(e=>e.email===A.email||e.walletAddress===S):null,L=e=>{g(e)},M=e=>{f(e),j(!0)},z=e=>e*N,W=e=>e>=.01?e.toFixed(4):e.toFixed(8),V=async()=>{if(!h||!S||!A)return;let e=_(h);if(!e)return void n.oR.error("Could not find your payment details");if("paid"===e.status){(0,n.oR)("You have already paid your share"),j(!1);return}let a="SPLIT-PAY-".concat(Date.now(),"-").concat(Math.floor(1e6*Math.random()));H({type:"",message:""});try{let s;s=z(e.amount).toFixed(8),console.log("Payment amount: ".concat(e.amount," USD → ").concat(s," ").concat((null==t?void 0:t.symbol)||"ETH")),await D(a,h.initiatorWalletAddress,s)}catch(e){console.error("Payment failed:",e),n.oR.error("Failed to make payment")}};(0,r.useEffect)(()=>{if(h&&"success"===P.type&&P.message.includes("Hash:")&&(null==A?void 0:A.email)){let e=P.message.split("Hash: ")[1];(async()=>{try{await er(h.splitId,A.email,e);let t=await es();m(t.data),n.oR.success("Your payment has been recorded"),setTimeout(()=>{j(!1),f(null)},2e3)}catch(e){console.error("Failed to update payment status:",e),n.oR.error("Payment was sent but failed to update status")}})()}},[P,h,null==A?void 0:A.email]);let J=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),G=e=>{switch(e.status){case"active":return(0,s.jsx)(en.A,{className:"h-5 w-5 text-yellow-500"});case"completed":return(0,s.jsx)(E.A,{className:"h-5 w-5 text-green-500"});case"cancelled":return(0,s.jsx)(I.A,{className:"h-5 w-5 text-red-500"});default:return null}};if(!A)return(0,s.jsx)("div",{className:"text-center py-8 border border-gray-200 dark:border-gray-700 rounded-md",children:"Please sign in to view your split bills"});if(y)return(0,s.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})});let O="initiated"===u?l:c;return null==t||t.symbol,(0,s.jsxs)("div",{className:"mt-4 w-full",children:[(0,s.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[(0,s.jsx)("button",{className:"px-4 py-2 font-medium text-sm ".concat("initiated"===u?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),onClick:()=>x("initiated"),children:"Splits You Created"}),(0,s.jsx)("button",{className:"px-4 py-2 font-medium text-sm ".concat("participating"===u?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),onClick:()=>x("participating"),children:"Splits to Pay"})]}),0===O.length?(0,s.jsx)("div",{className:"text-center py-8 border border-gray-200 dark:border-gray-700 rounded-md",children:"No split bills found"}):(0,s.jsx)("div",{className:"space-y-4",children:O.map(e=>(0,s.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("h3",{className:"font-medium text-lg",children:["Split ",e.splitId]}),(0,s.jsx)("div",{className:"ml-2",children:G(e)})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["For invoice ",e.invoiceNumber]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Total: "}),(0,s.jsxs)("span",{className:"font-medium",children:[e.totalAmount," USD"]})]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Due: "}),(0,s.jsx)("span",{className:"font-medium",children:J(e.dueDate)})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("button",{onClick:()=>L(e),className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"View Details"}),"participating"===u&&(()=>{let t=_(e);return t?"paid"===t.status?(0,s.jsxs)("span",{className:"text-sm text-green-600 dark:text-green-500 flex items-center",children:[(0,s.jsx)(E.A,{className:"h-4 w-4 mr-1"}),"Paid"]}):"active"===e.status?(0,s.jsxs)("button",{onClick:()=>M(e),className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:["Pay ",t.amount," USD"]}):null:null})()]})]}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,s.jsx)(el.A,{className:"h-4 w-4 mr-1"}),(0,s.jsxs)("span",{children:[e.participants.filter(e=>"paid"===e.status).length," of ",e.participants.length," paid"]})]})})]},e._id))}),b&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-2xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold",children:"Split Details"}),(0,s.jsx)("button",{onClick:()=>g(null),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(I.A,{size:20})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Split ID"}),(0,s.jsx)("p",{className:"font-medium",children:b.splitId})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Invoice"}),(0,s.jsx)("p",{className:"font-medium",children:b.invoiceNumber})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Amount"}),(0,s.jsxs)("p",{className:"font-medium",children:[b.totalAmount," USD"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:J(b.dueDate)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),(0,s.jsxs)("div",{className:"flex items-center",children:[G(b),(0,s.jsx)("span",{className:"ml-2 capitalize",children:b.status})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Created"}),(0,s.jsx)("p",{className:"font-medium",children:J(b.createdAt)})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Participants"}),(0,s.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700 border border-gray-200 dark:border-gray-700 rounded-md",children:b.participants.map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between items-center p-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.nickname}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"font-medium",children:[e.amount," USD"]}),(0,s.jsx)("p",{className:"text-sm ".concat("paid"===e.status?"text-green-600 dark:text-green-500":"text-yellow-600 dark:text-yellow-500"),children:"paid"===e.status?(0,s.jsxs)("span",{className:"flex items-center justify-end",children:[(0,s.jsx)(E.A,{className:"h-3 w-3 mr-1"}),"Paid on ",J(e.paymentDate||"")]}):(0,s.jsx)("span",{children:"Pending"})})]})]},t))})]}),"completed"===b.status&&b.completedDate&&(0,s.jsx)("div",{className:"bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 rounded-md p-3",children:(0,s.jsxs)("p",{className:"text-green-700 dark:text-green-400 flex items-center",children:[(0,s.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"All participants have paid. Split completed on ",J(b.completedDate)]})})]}),(0,s.jsx)("div",{className:"mt-6 flex justify-end",children:(0,s.jsx)("button",{onClick:()=>g(null),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Close"})})]})}),v&&h&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold",children:"Pay Your Share"}),!F&&(0,s.jsx)("button",{onClick:()=>j(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(I.A,{size:20})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-md",children:[(0,s.jsxs)("p",{className:"font-medium",children:["Split ID: ",h.splitId]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:["Invoice: ",h.invoiceNumber]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:["Due: ",J(h.dueDate)]})]}),(()=>{let e=_(h);if(!e)return null;let a=z(e.amount);return(0,s.jsxs)("div",{className:"p-4 border border-blue-100 dark:border-blue-900 rounded-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("span",{className:"font-medium flex items-center",children:[(0,s.jsx)(C.A,{className:"h-4 w-4 mr-1"}),"USD Amount:"]}),(0,s.jsxs)("span",{className:"font-bold",children:[e.amount," USD"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("span",{className:"font-medium",children:"Token Equivalent:"}),(0,s.jsxs)("span",{className:"font-bold",children:[W(a)," ",(null==t?void 0:t.symbol)||"ETH"]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Exchange Rate: 1 USD = ",N.toFixed(6)," ",(null==t?void 0:t.symbol)||"ETH"]}),(0,s.jsxs)("p",{className:"text-sm mt-3",children:["Paying to: ",h.initiatorWalletAddress.substring(0,8),"..."]})]})})(),F&&(0,s.jsx)(R,{message:{type:"info",message:"Processing your payment..."}}),P.type&&(0,s.jsx)(R,{message:P,onDismiss:()=>H({type:"",message:""})})]}),(0,s.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,s.jsx)("button",{onClick:()=>j(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:F,children:"Cancel"}),(0,s.jsx)("button",{onClick:V,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed",disabled:F||"success"===P.type,children:F?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Processing..."]}):"Confirm Payment"})]})]})})]})},ed=async e=>(await ee.A.get("/invoices/client-invoices?email=".concat(encodeURIComponent(e)))).data,eo=async e=>(await ee.A.post("/invoices",e)).data,ec=async(e,t,a)=>(await ee.A.patch("/invoices/".concat(e,"/payment"),{paymentStatus:t,transactionHash:a})).data;var em=a(94631),eu=a(85339),ex=a(84616),ey=a(87712);let ep=e=>{let{invoice:t,onClose:a,onSuccess:l,tokenSymbol:i="ETH"}=e,[c,m]=(0,r.useState)([]),[u,x]=(0,r.useState)(!0),[y,p]=(0,r.useState)([]),[b,g]=(0,r.useState)(0),[h,f]=(0,r.useState)(0),[v,j]=(0,r.useState)(0),[N,k]=(0,r.useState)(""),[w,S]=(0,r.useState)(!1),{address:A}=(0,d.F)(),C=(0,o.e)(),D=A||"";(0,r.useEffect)(()=>{(async()=>{if(C)try{var e;let a,s=(null==(e=C.chain)?void 0:e.id)||1;a="transport"in C&&"url"in C.transport?new B.FR(C.transport.url):new B.FR;let r=await (0,U.E)(a,i,s);g(r),console.log("Exchange rate loaded: 1 USD = ".concat(r," ").concat(i)),f(t.amount*r)}catch(e){console.error("Failed to fetch ".concat(i," exchange rate:"),e),i.includes("USD")?(g(1),f(t.amount)):(g(.001),f(.001*t.amount))}})()},[C,i,t.amount]),(0,r.useEffect)(()=>{j(t.amount)},[t.amount]),(0,r.useEffect)(()=>{(async()=>{x(!0);try{let e=await (0,T.QC)();m(e.data)}catch(e){console.error("Failed to load contacts:",e),n.oR.error("Failed to load your contacts"),k("Could not load your contacts. Please try again.")}finally{x(!1)}})()},[]),(0,r.useEffect)(()=>{let e=y.reduce((e,t)=>e+t.amount,0);j(parseFloat((t.amount-e).toFixed(2)))},[y,t.amount]);let E=e=>{p(y.filter((t,a)=>a!==e))},F=(e,t)=>{let a=[...y];a[e].amount=t,a[e].tokenAmount=parseFloat((t*b).toFixed(8)),p(a)},P=(e,t)=>{let a=[...y];a[e].nickname=t,p(a)},H=async()=>{if(0===y.length)return void k("Add at least one friend to split the bill with.");if(v<0)return void k("The total split amount exceeds the invoice amount.");if(!D)return void k("Your wallet address is required to create a split.");S(!0),k("");try{let e=y.map(e=>({nickname:e.nickname,amount:e.amount}));await et(t._id,D,e),n.oR.success("Split bill created successfully!"),l(),a()}catch(t){var e,s;console.error("Failed to create split bill:",t),k((null==(s=t.response)||null==(e=s.data)?void 0:e.message)||"Failed to create split bill. Please try again."),n.oR.error("Failed to create split bill")}finally{S(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-2xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold",children:["Split Invoice ",t.invoiceNumber]}),(0,s.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",disabled:w,children:(0,s.jsx)(I.A,{size:20})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Invoice Amount (USD)"}),(0,s.jsxs)("p",{className:"font-medium text-lg",children:[t.amount," USD"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(t.dueDate).toLocaleDateString()})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md mb-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Exchange Rate:"}),(0,s.jsxs)("span",{className:"font-medium",children:["1 USD = ",b>0?b.toFixed(6):"..."," ",i]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total in ",i,":"]}),(0,s.jsxs)("span",{className:"font-bold text-lg",children:[(e=>e>=.01?e.toFixed(4):e.toFixed(8))(h)," ",i]})]})]}),N&&(0,s.jsx)(R,{message:{type:"error",message:N},onDismiss:()=>k("")}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(el.A,{className:"h-5 w-5 mr-2"}),(0,s.jsx)("h4",{className:"font-medium",children:"Friends to Split With"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{type:"button",onClick:()=>{if(0===y.length)return void k("Add friends first to split evenly.");let e=y.length+1,a=parseFloat((t.amount/e).toFixed(2)),s=parseFloat((a*b).toFixed(8));p(y.map(e=>({...e,amount:a,tokenAmount:s})))},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline mr-4",disabled:0===y.length||w,children:"Split Evenly"}),(0,s.jsxs)("button",{type:"button",onClick:()=>{if(0===c.length)return void k("No contacts available in your address book.");let e=c.filter(e=>!y.some(t=>t.nickname===e.nickname));if(0===e.length)return void k("All your contacts have been added already.");let t=parseFloat((.5*v).toFixed(2)),a=parseFloat((t*b).toFixed(8));p([...y,{nickname:e[0].nickname,amount:t,tokenAmount:a}])},className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-1 px-3 rounded text-sm",disabled:u||w,children:[(0,s.jsx)(ex.A,{size:14,className:"inline mr-1"}),"Add Friend"]})]})]}),u?(0,s.jsx)("div",{className:"text-center py-4",children:"Loading contacts..."}):(0,s.jsxs)("div",{children:[0===y.length?(0,s.jsx)("div",{className:"text-center py-4 border border-dashed border-gray-300 dark:border-gray-600 rounded-md",children:'Click "Add Friend" to start splitting'}):(0,s.jsx)("div",{className:"space-y-3",children:y.map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("select",{value:e.nickname,onChange:e=>P(a,e.target.value),className:"w-full bg-transparent border-b border-gray-300 dark:border-gray-600 py-1 focus:outline-none",disabled:w,children:c.map(e=>(0,s.jsx)("option",{value:e.nickname,disabled:y.some((t,s)=>s!==a&&t.nickname===e.nickname),children:e.nickname},e._id))})}),(0,s.jsxs)("div",{className:"flex flex-col items-end",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"number",value:e.amount,onChange:e=>F(a,parseFloat(e.target.value)||0),step:"0.01",min:"0.01",max:t.amount.toString(),className:"w-20 bg-transparent border-b border-gray-300 dark:border-gray-600 py-1 text-right focus:outline-none",disabled:w}),(0,s.jsx)("span",{className:"ml-1",children:"USD"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["≈ ",e.tokenAmount.toFixed(8)," ",i]})]}),(0,s.jsx)("button",{type:"button",onClick:()=>E(a),className:"text-red-500 hover:text-red-700 dark:hover:text-red-400",disabled:w,children:(0,s.jsx)(ey.A,{size:18})})]},a))}),(0,s.jsxs)("div",{className:"flex justify-between mt-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Your portion (remaining):"}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["≈ ",(v*b).toFixed(8)," ",i]})]}),(0,s.jsxs)("span",{className:"font-medium ".concat(v<0?"text-red-600 dark:text-red-500":"text-green-600 dark:text-green-500"),children:[v.toFixed(2)," USD"]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:w,children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:H,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed",disabled:w||u||0===y.length||v<0,children:w?"Creating...":"Create Split Bill"})]})]})})},eb=e=>{let{selectedToken:t}=e,[a,l]=(0,r.useState)([]),[i,d]=(0,r.useState)(!0),[c,m]=(0,r.useState)(null),[u,x]=(0,r.useState)(!1),[y,p]=(0,r.useState)(!1),[b,g]=(0,r.useState)(""),[h,f]=(0,r.useState)(0),[v,j]=(0,r.useState)(""),[N,k]=(0,r.useState)(""),[S,A]=(0,r.useState)(!1),[T,D]=(0,r.useState)(null),[F,P]=(0,r.useState)(0),[H,_]=(0,r.useState)(!1),{user:L}=(0,$.A)(),M=(0,o.e)(),{sendPayment:z,isLoading:W,resultMessage:V,fetchUserCoins:J,coinObjects:G,setResultMessage:O}=w(t),Y=(0,r.useMemo)(()=>{var e,a;return(null==t?void 0:t.symbol)?t.symbol:(null==M||null==(a=M.chain)||null==(e=a.nativeCurrency)?void 0:e.symbol)?M.chain.nativeCurrency.symbol:"ETH"},[t,M]);(0,r.useEffect)(()=>()=>{O({type:"",message:""}),g("")},[O]),(0,r.useEffect)(()=>{(async()=>{if(t&&M)try{var e;let a,s=(null==(e=M.chain)?void 0:e.id)||1;a="transport"in M&&"url"in M.transport?new B.FR(M.transport.url):new B.FR;let r=await (0,U.E)(a,t.symbol,s);f(r)}catch(e){console.error("Failed to fetch ".concat(Y," exchange rate:"),e),t.symbol.includes("USD")?f(1):f(.001)}})()},[t,M,Y]),(0,r.useEffect)(()=>{if(c&&h>0){let e=parseFloat(c.amount.toString()),a=e*h,s=(null==t?void 0:t.decimals)?Math.min(t.decimals,6):6;k(a.toFixed(s)),j(e.toFixed(2))}else k(""),j("")},[c,h,t]),(0,r.useEffect)(()=>{if(y&&V.type&&c)if("success"===V.type){let e=V.message.match(/Hash: (0x[a-fA-F0-9]+)/),t=e?e[1]:null;t?ec(c._id,"paid",t).then(()=>{l(a.map(e=>e._id===c._id?{...e,paymentStatus:"paid",transactionHash:t}:e)),H||(n.oR.success("Invoice paid successfully!"),_(!0)),setTimeout(()=>{x(!1),m(null),p(!1)},2e3)}).catch(e=>{console.error("Failed to update invoice status:",e),H||(n.oR.error("Payment was successful, but failed to update invoice status"),_(!0)),p(!1),g("Payment successful but invoice update failed. Please contact support.")}):(g("Transaction completed but could not extract transaction hash."),p(!1))}else"error"===V.type&&(g("Payment failed: ".concat(V.message)),p(!1))},[V,y,c,a,H]),(0,r.useEffect)(()=>{(async()=>{if(null==L?void 0:L.email)try{d(!0);let e=await ed(L.email);l(e.data)}catch(e){n.oR.error("Failed to fetch invoices"),console.error(e)}finally{d(!1)}})()},[null==L?void 0:L.email]);let q=e=>{m(e),x(!0),g(""),_(!1)},Q=e=>{D(e),A(!0)},Z=(0,r.useCallback)(e=>!!G&&0!==G.length&&!!e&&!!t&&G.reduce((e,t)=>e+Number(t.balance),0)>=parseFloat(e),[G,t]),K=async()=>{if(!c||!N)return;if(!Z(N))return void g("Insufficient funds to pay this invoice (".concat(N," ").concat(Y,")"));let e="INV-".concat(c._id,"-").concat(Date.now());O({type:"",message:""}),g(""),p(!0);try{await z(e,c.walletAddress,N),J()}catch(e){console.error("Payment failed:",e),g("Failed to initiate payment"),p(!1)}},X=e=>{var t,a;if(!(null==M?void 0:M.chain))return"https://etherscan.io/tx/".concat(e);let s=null==(a=M.chain.blockExplorers)||null==(t=a.default)?void 0:t.url;if(s)return"".concat(s,"/tx/").concat(e);switch(M.chain.id){case 1:default:return"https://etherscan.io/tx/".concat(e);case 137:return"https://polygonscan.com/tx/".concat(e);case 56:return"https://bscscan.com/tx/".concat(e);case 43114:return"https://snowtrace.io/tx/".concat(e);case 42161:return"https://arbiscan.io/tx/".concat(e);case 10:return"https://optimistic.etherscan.io/tx/".concat(e);case 80002:return"https://amoy.polygonscan.com/tx/".concat(e)}},ee=e=>{switch(e){case"pending":return(0,s.jsx)(en.A,{className:"h-5 w-5 text-yellow-500"});case"paid":return(0,s.jsx)(E.A,{className:"h-5 w-5 text-green-500"});case"cancelled":return(0,s.jsx)(I.A,{className:"h-5 w-5 text-red-500"});default:return null}};return i?(0,s.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,s.jsx)(em.A,{className:"animate-spin h-8 w-8"})}):(0,s.jsxs)("div",{className:"mt-4 w-full",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Your Invoices"}),0===a.length?(0,s.jsx)("div",{className:"text-center py-8 border border-gray-200 dark:border-gray-700 rounded-md",children:"No invoices found"}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Invoice #"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"From"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amount (USD)"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Due Date"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Action"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.invoiceNumber}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.createdBy}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.amount," USD"]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(e.dueDate).toLocaleDateString()}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap flex items-center",children:[ee(e.paymentStatus),(0,s.jsx)("span",{className:"ml-2",children:e.paymentStatus})]}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:["pending"===e.paymentStatus&&(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>q(e),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-1 px-3 rounded",disabled:!e.walletAddress,children:"Pay"}),(0,s.jsxs)("button",{onClick:()=>Q(e),className:"border border-blue-600 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 font-medium py-1 px-3 rounded flex items-center",children:[(0,s.jsx)(el.A,{size:16,className:"mr-1"}),"Split"]})]}),"paid"===e.paymentStatus&&e.transactionHash&&(0,s.jsx)("a",{href:X(e.transactionHash),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"View Transaction"})]})]},e._id))})]})}),u&&c&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold",children:["Pay Invoice ",c.invoiceNumber]}),!y&&!W&&(0,s.jsx)("button",{onClick:()=>x(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(I.A,{size:20})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-md",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"From"}),(0,s.jsx)("p",{className:"font-medium",children:c.createdBy})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(c.dueDate).toLocaleDateString()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),(0,s.jsxs)("div",{className:"font-medium flex items-center",children:[ee(c.paymentStatus),(0,s.jsx)("span",{className:"ml-2 capitalize",children:c.paymentStatus})]})]})]}),c.description&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Description"}),(0,s.jsx)("p",{className:"font-medium",children:c.description})]})]}),(0,s.jsx)("div",{className:"p-4 border border-blue-100 dark:border-blue-900 rounded-md",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"USD Amount:"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(C.A,{size:16,className:"text-gray-400 mr-1"}),(0,s.jsx)("span",{className:"text-lg font-bold",children:c.amount})]})]}),h>0&&N&&(0,s.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,s.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[Y," to Pay:"]}),(0,s.jsxs)("span",{className:"text-lg font-bold",children:[N," ",Y]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Exchange Rate: 1 USD = ",h>0?h.toFixed(6):"..."," ",Y]})]})}),(0,s.jsxs)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Recipient Address"}),(0,s.jsx)("p",{className:"font-mono text-sm break-all mt-1",children:c.walletAddress})]}),b?(0,s.jsx)(R,{message:{type:"error",message:b},onDismiss:()=>g("")}):y||W?(0,s.jsx)(R,{message:{type:"info",message:V.message||"Processing your payment..."}}):V.type?(0,s.jsx)(R,{message:V,onDismiss:()=>O({type:"",message:""})}):null]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[!V.type&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>x(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:W||y,children:"Cancel"}),(0,s.jsx)("button",{onClick:K,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors",disabled:W||y||!Z(N),children:W||y?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(em.A,{className:"animate-spin mr-2 h-4 w-4"}),"Processing..."]}):"Pay ".concat(N," ").concat(Y," (").concat(c.amount," USD)")})]}),"success"===V.type&&(0,s.jsx)("button",{onClick:()=>x(!1),className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Close"})]}),c&&!Z(N)&&(0,s.jsxs)("div",{className:"mt-4 text-sm text-red-600 dark:text-red-400",children:[(0,s.jsx)(eu.A,{className:"inline h-4 w-4 mr-1"}),"Insufficient funds to complete this payment"]})]})}),S&&T&&(0,s.jsx)(ep,{invoice:T,onClose:()=>A(!1),onSuccess:()=>{P(e=>e+1),n.oR.success("Invoice split successfully!")},tokenSymbol:Y})]})},eg=()=>{let{user:e}=(0,$.A)(),[t,a]=(0,r.useState)({clientName:"",clientEmail:"",dueDate:"",description:"",amount:"",walletAddress:""}),[l,i]=(0,r.useState)(!1),[d,o]=(0,r.useState)(!0),c=e=>{let{name:t,value:s}=e.target;a(e=>({...e,[t]:s}))},m=async e=>{if(e.preventDefault(),!t.clientEmail||!t.amount||!t.dueDate)return void n.oR.error("Please fill in all required fields");try{var s;i(!0);let e=await eo({...t,amount:parseFloat(t.amount)});if(d&&(null==(s=e.data)?void 0:s._id))try{await (0,T.VR)(e.data._id),n.oR.success("Invoice created and contact added to address book")}catch(e){console.log("Failed to add contact to address book:",e),n.oR.success("Invoice created, but failed to add contact")}else n.oR.success("Invoice created successfully");a({clientName:"",clientEmail:"",dueDate:"",description:"",amount:"",walletAddress:""})}catch(e){console.error("Failed to create invoice:",e),n.oR.error("Failed to create invoice")}finally{i(!1)}};return e?(0,s.jsx)("div",{className:"p-4 rounded-lg mt-10",children:(0,s.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"clientName",className:"block text-sm font-medium mb-1",children:"Client Name"}),(0,s.jsx)("input",{type:"text",id:"clientName",name:"clientName",value:t.clientName,onChange:c,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"clientEmail",className:"block text-sm font-medium mb-1",children:"Client Email *"}),(0,s.jsx)("input",{type:"email",id:"clientEmail",name:"clientEmail",value:t.clientEmail,onChange:c,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium mb-1",children:"Amount *"}),(0,s.jsx)("input",{type:"number",id:"amount",name:"amount",value:t.amount,onChange:c,min:"0.000000001",step:"0.000000001",className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium mb-1",children:"Due Date *"}),(0,s.jsx)("input",{type:"date",id:"dueDate",name:"dueDate",value:t.dueDate,onChange:c,min:new Date().toISOString().split("T")[0],className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"walletAddress",className:"block text-sm font-medium mb-1",children:"Your Wallet Address (to receive payment)"}),(0,s.jsx)("input",{type:"text",id:"walletAddress",name:"walletAddress",value:t.walletAddress,onChange:c,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",placeholder:"0x..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium mb-1",children:"Description"}),(0,s.jsx)("textarea",{id:"description",name:"description",value:t.description,onChange:c,rows:3,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"addToAddressBook",checked:d,onChange:e=>{o(e.target.checked)},className:"mr-2 h-4 w-4"}),(0,s.jsx)("label",{htmlFor:"addToAddressBook",className:"text-sm text-gray-700 dark:text-gray-300",children:"Add client to address book"})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400",children:l?"Creating...":"Create Invoice"})})]})}):(0,s.jsx)("div",{className:"p-4 text-center",children:"Please sign in to create invoices."})};var eh=a(63439),ef=a(57340),ev=a(6874),ej=a.n(ev),eN=a(72883),ek=a(53999);let ew=eN.bL,eS=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eN.B8,{ref:t,className:(0,ek.cn)("inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-gray-800 dark:text-gray-400",a),...r})});eS.displayName=eN.B8.displayName;let eA=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eN.l9,{ref:t,className:(0,ek.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm dark:ring-offset-gray-950 dark:focus-visible:ring-gray-800 dark:data-[state=active]:bg-gray-950 dark:data-[state=active]:text-gray-50",a),...r})});eA.displayName=eN.l9.displayName;let eC=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eN.UC,{ref:t,className:(0,ek.cn)("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-800",a),...r})});eC.displayName=eN.UC.displayName;let eT=function(){let{address:e}=(0,d.F)(),t=(0,S.i)(),[a,n]=(0,r.useState)(void 0),[l,i]=(0,r.useState)(0);return(0,r.useEffect)(()=>{if(t){let e=j[t];e&&e.length>0&&n(e[0])}},[t]),(0,s.jsxs)("div",{className:"relative h-screen w-screen dark:text-white text-black p-6 z-10",children:[(0,s.jsx)("div",{className:"absolute top-4 left-4",children:(0,s.jsx)(ej(),{href:"/",children:(0,s.jsx)(ef.A,{className:"text-black dark:hover:text-gray-200 hover:text-gray-800 dark:text-white",size:30})})}),(0,s.jsxs)("div",{className:"flex flex-col max-w-screen max-h-screen items-center m-10",children:[(0,s.jsxs)("div",{className:"w-full flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"PayZoll P2P Payments"}),(0,s.jsx)(eh.pK,{})]}),e?a?(0,s.jsxs)(ew,{defaultValue:"transfer",className:"min-w-[90%]",children:[(0,s.jsxs)(eS,{className:"grid w-full grid-cols-4",children:[(0,s.jsx)(eA,{value:"transfer",children:"Secure Transfer"}),(0,s.jsx)(eA,{value:"invoices",children:"My Invoices"}),(0,s.jsx)(eA,{value:"splitbills",children:"Split Bills"}),(0,s.jsx)(eA,{value:"create-invoice",children:"Create Invoice"})]}),(0,s.jsx)(eC,{value:"transfer",children:(0,s.jsx)(X,{selectedToken:a})}),(0,s.jsx)(eC,{value:"invoices",children:(0,s.jsx)(eb,{selectedToken:a})}),(0,s.jsx)(eC,{value:"splitbills",children:(0,s.jsx)(ei,{selectedToken:a,refreshTrigger:l})}),(0,s.jsx)(eC,{value:"create-invoice",children:(0,s.jsx)(eg,{})})]}):(0,s.jsx)("div",{className:"dark:text-white text-black border-2 border-blue-200 p-4 rounded-md",children:(0,s.jsx)("p",{children:"No compatible tokens found for the current chain. Please switch networks."})}):(0,s.jsx)("div",{className:"dark:text-white text-black border-2 border-blue-200 p-4 rounded-md",children:(0,s.jsx)("p",{children:"Please connect your wallet to use these features."})})]})]})}},84356:(e,t,a)=>{"use strict";a.d(t,{Fm:()=>r,RL:()=>n,f6:()=>l});var s=a(21988);let r="0x0000000000000000000000000000000000000000",n={[s.V9.id]:"0x0000000000000000000000000000000000000000"},l={[s.V9.id]:[{symbol:"HBAR",address:"0x0000000000000000000000000000000000000000",decimals:18,priceFeed:""}]}}},e=>{var t=t=>e(e.s=t);e.O(0,[844,8451,742,6732,5310,2265,6083,1312,7822,8441,1684,7358],()=>t(58694)),_N_E=e.O()}]);